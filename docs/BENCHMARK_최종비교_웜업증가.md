# 벤치마크 최종 비교

## 1. 측정 환경

- **웜업 설정**: 3 iterations, 2초 (이전: 1 iteration, 1초)
- **측정 설정**: 3 iterations, 2초 (이전: 2 iterations, 1초)
- **측정 시간**: 각 시나리오당 약 5분

## 2. 시나리오별 벤치마크 결과

### 2.1 시나리오 1: 원본코드, JVM 튜닝 없음

**설정:**

- 코드: TpsBenchmark.java (최적화 전)
- JVM: 기본 설정 (Non-Heap 제한 없음)
- Heap: 2GB
- GC: G1GC

**벤치마크 결과 (TPS 기준):**

| 벤치마크      | 주문 수 | 시간 (μs/op) | TPS       | Error      |
| ------------- | ------- | ------------ | --------- | ---------- |
| limitOrderTps | 1,000   | 424.176      | **2,357** | ±446.438   |
| limitOrderTps | 5,000   | 1,922.456    | **520**   | ±911.352   |
| limitOrderTps | 10,000  | 4,234.911    | **236**   | ±7087.431  |
| limitOrderTps | 50,000  | 18,552.655   | **54**    | ±6873.476  |
| marketBuyTps  | 1,000   | 606.509      | **1,649** | ±194.338   |
| marketBuyTps  | 5,000   | 2,632.712    | **380**   | ±305.569   |
| marketBuyTps  | 10,000  | 5,301.380    | **189**   | ±1147.361  |
| marketBuyTps  | 50,000  | 27,322.538   | **37**    | ±18337.209 |
| mixedTps      | 1,000   | 520.454      | **1,921** | ±97.651    |
| mixedTps      | 5,000   | 2,627.036    | **381**   | ±7709.092  |
| mixedTps      | 10,000  | 5,056.261    | **198**   | ±340.334   |
| mixedTps      | 50,000  | 24,344.363   | **41**    | ±6411.260  |

**GC 통계:**

- 총 GC 발생: 51회
- 평균 pause time: 1.42ms
- 최대 pause time: **7.53ms** (가장 높음)
- 최소 pause time: 0.91ms

### 2.2 시나리오 2: Non-Heap 제한만 (JVM 튜닝)

**설정:**

- 코드: TpsBenchmark.java (최적화 전)
- JVM: Non-Heap 제한 적용
  - Metaspace: 256MB
  - Code Cache: 128MB
  - Direct Memory: 64MB
  - Thread Stack: 512KB
- Heap: 2GB
- GC: G1GC

**벤치마크 결과 (TPS 기준):**

| 벤치마크      | 주문 수 | 시간 (μs/op) | TPS       | Error      |
| ------------- | ------- | ------------ | --------- | ---------- |
| limitOrderTps | 1,000   | 388.778      | **2,572** | ±65.879    |
| limitOrderTps | 5,000   | 2,019.872    | **495**   | ±3346.051  |
| limitOrderTps | 10,000  | 3,768.605    | **265**   | ±490.984   |
| limitOrderTps | 50,000  | 21,618.401   | **46**    | ±78008.322 |
| marketBuyTps  | 1,000   | 542.467      | **1,843** | ±412.653   |
| marketBuyTps  | 5,000   | 2,722.198    | **367**   | ±513.650   |
| marketBuyTps  | 10,000  | 5,117.422    | **195**   | ±373.792   |
| marketBuyTps  | 50,000  | 26,398.242   | **38**    | ±4766.726  |
| mixedTps      | 1,000   | 491.733      | **2,034** | ±153.113   |
| mixedTps      | 5,000   | 2,550.783    | **392**   | ±2668.896  |
| mixedTps      | 10,000  | 4,778.014    | **209**   | ±4173.715  |
| mixedTps      | 50,000  | 24,612.848   | **41**    | ±2966.997  |

**GC 통계:**

- 총 GC 발생: 51회
- 평균 pause time: 1.29ms
- 최대 pause time: **2.54ms** (시나리오 1 대비 66% 개선!)
- 최소 pause time: 0.90ms

### 2.3 시나리오 3: 최적화 코드 + JVM 튜닝

**설정:**

- 코드: TpsBenchmarkOptimized.java (BigDecimal 캐싱)
- JVM: Non-Heap 제한 적용
  - Metaspace: 256MB
  - Code Cache: 128MB
  - Direct Memory: 64MB
  - Thread Stack: 512KB
- Heap: 2GB
- GC: G1GC

**벤치마크 결과 (TPS 기준):**

| 벤치마크      | 주문 수 | 시간 (μs/op) | TPS       | Error      |
| ------------- | ------- | ------------ | --------- | ---------- |
| limitOrderTps | 1,000   | 360.009      | **2,778** | ±33.369    |
| limitOrderTps | 5,000   | 1,826.211    | **548**   | ±655.352   |
| limitOrderTps | 10,000  | 3,735.708    | **268**   | ±4294.167  |
| limitOrderTps | 50,000  | 17,746.629   | **56**    | ±3275.367  |
| marketBuyTps  | 1,000   | 517.351      | **1,933** | ±375.050   |
| marketBuyTps  | 5,000   | 2,509.046    | **399**   | ±569.410   |
| marketBuyTps  | 10,000  | 5,075.987    | **197**   | ±401.785   |
| marketBuyTps  | 50,000  | 25,743.665   | **39**    | ±24029.869 |
| mixedTps      | 1,000   | 467.890      | **2,137** | ±44.891    |
| mixedTps      | 5,000   | 2,362.381    | **423**   | ±93.081    |
| mixedTps      | 10,000  | 4,460.359    | **224**   | ±296.487   |
| mixedTps      | 50,000  | 22,895.762   | **44**    | ±3187.791  |

**GC 통계:**

- 총 GC 발생: 49회
- 평균 pause time: 1.30ms
- 최대 pause time: **2.50ms**
- 최소 pause time: 0.90ms

## 3. 시나리오별 비교 (주문 수 1,000 기준)

| 벤치마크      | 시나리오 1 (기본) | 시나리오 2 (JVM만) | 시나리오 3 (JVM+코드) | 시나리오 2 효과 | 시나리오 3 효과 |
| ------------- | ----------------- | ------------------ | --------------------- | --------------- | --------------- |
| limitOrderTps | 2,357 TPS         | 2,572 TPS          | **2,778 TPS**         | +9.1% ⬆️        | **+17.9% ⬆️**   |
| marketBuyTps  | 1,649 TPS         | 1,843 TPS          | 1,933 TPS             | +11.8% ⬆️       | +17.2% ⬆️       |
| mixedTps      | 1,921 TPS         | 2,034 TPS          | 2,137 TPS             | +5.9% ⬆️        | +11.2% ⬆️       |

## 4. GC 통계 비교

| 항목            | 시나리오 1 (기본) | 시나리오 2 (JVM만) | 시나리오 3 (JVM+코드) | 개선 효과               |
| --------------- | ----------------- | ------------------ | --------------------- | ----------------------- |
| 평균 pause time | 1.42ms            | 1.29ms             | 1.30ms                | 약간 개선               |
| 최대 pause time | **7.53ms**        | **2.54ms**         | **2.50ms**            | **66% 개선!** ⬇️        |
| 최소 pause time | 0.91ms            | 0.90ms             | 0.90ms                | 동일                    |
| GC 빈도         | 51회              | 51회               | 49회                  | 코드 최적화로 약간 감소 |

## 5. 주요 발견 사항

### 5.1 웜업 증가의 효과

**이전 측정 (웜업 1회, 1초):**

- 시나리오 3이 가장 낮은 성능 (측정 오차로 인한 것으로 추정)

**현재 측정 (웜업 3회, 2초):**

- 시나리오 3이 **가장 높은 성능** (limitOrderTps @1,000: 2,778 TPS)
- JIT 컴파일이 충분히 완료되어 실제 성능이 드러남

### 5.2 JVM 튜닝 효과

**Non-Heap 제한의 효과:**

- 최대 pause time: 7.53ms → 2.54ms (**66% 개선!**)
- TPS 향상: limitOrderTps @1,000에서 +9.1% 향상
- 안정성 크게 향상

### 5.3 코드 최적화 효과

**BigDecimal 캐싱의 효과:**

- limitOrderTps @1,000: 2,572 → 2,778 TPS (**+8.0% 추가 향상**)
- marketBuyTps @1,000: 1,843 → 1,933 TPS (+4.9% 추가 향상)
- mixedTps @1,000: 2,034 → 2,137 TPS (+5.1% 추가 향상)
- GC 빈도: 51회 → 49회 (약간 감소)

### 5.4 전체 개선 효과

**시나리오 1 → 시나리오 3:**

- limitOrderTps @1,000: 2,357 → 2,778 TPS (**+17.9% 향상!**)
- marketBuyTps @1,000: 1,649 → 1,933 TPS (+17.2% 향상)
- mixedTps @1,000: 1,921 → 2,137 TPS (+11.2% 향상)
- 최대 pause time: 7.53ms → 2.50ms (**67% 개선!**)

## 6. 결론

### 6.1 최적 설정

**권장 설정:**

- 코드: TpsBenchmarkOptimized.java (BigDecimal 캐싱)
- JVM: Non-Heap 제한 + G1GC
  - Metaspace: 256MB
  - Code Cache: 128MB
  - Direct Memory: 64MB
  - Thread Stack: 512KB

### 6.2 개선 효과

1. **TPS 향상**: 초기 대비 최대 17.9% 향상 (limitOrderTps)
2. **GC 안정성**: 최대 pause time 67% 개선
3. **측정 신뢰성**: 웜업 증가로 실제 성능이 정확히 측정됨

### 6.3 교훈

1. **웜업의 중요성**: 웜업이 부족하면 측정 오차가 커서 잘못된 결론을 내릴 수 있음
2. **JVM 튜닝 효과**: Non-Heap 제한만으로도 안정성과 성능이 크게 개선됨
3. **코드 최적화 효과**: BigDecimal 캐싱이 실제로 성능 향상에 기여함 (웜업이 충분할 때)

---

**측정 일시**: 2026-01-12  
**웜업 설정**: 3 iterations, 2초  
**측정 설정**: 3 iterations, 2초
